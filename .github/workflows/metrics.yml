name: Generate GitHub Metrics

on:
  schedule:
    - cron: '0 0 * * *' # daily at UTC midnight
  workflow_dispatch: {}
  push:
    branches: ["main", "master"]

permissions:
  contents: write

jobs:
  generate-metrics:
    name: Generate GitHub Metrics SVG
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Generate metrics (languages only)
        uses: lowlighter/metrics@latest
        with:
          # Token used to read repo data (use a repo secret named METRICS_TOKEN)
          token: ${{ secrets.METRICS_TOKEN }}

          # Output filename (committed back to repo)
          filename: github-languages.svg

          # Compact output â€” only show configured plugins
          base: ""

          # Languages plugin (compact, similar to your previous card)
          plugin_languages: yes
          plugin_languages_limit: 6
          plugin_languages_ignored: html, css, tex
          plugin_languages_details: percentage
          plugin_languages_sections: most-used
          plugin_languages_indepth: no

      - name: Commit generated SVG
        uses: EndBug/add-and-commit@v9
        with:
          author_name: github-actions[bot]
          author_email: 41898282+github-actions[bot]@users.noreply.github.com
          message: chore(metrics): update github-languages.svg
          add: github-languages.svg
